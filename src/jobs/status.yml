description: Sens status message to Teams Workflow via Web Hook
executor: default

parameters:
  teams_url:
    type: string
    description: URL of the Teams Workflow
  failed_message:
    type: string
    default: "ðŸ”´ Failed"
    description: "Message text if tests are failed"
  passed_message:
    type: string
    default: "ðŸŸ¢ Successful"
    description: "Message text if tests are passed"
steps:
  - run:
      name: Set failed status
      command: |
        echo 'export MSG_STATUS="failed"' >> $BASH_ENV
      when: on_fail
      descrioption: setup message and color for case if tests failed.
  - run:
      name: Set Success status
      command: |
        echo 'export MSG_STATUS="success"' >> $BASH_ENV
      when: on_success
      descrioption: setup message and color for case if tests passed.
  - when: 
      condition:
        equels: [failed, "$MSG_STATUS"]  
      steps: 
        - send_msg:
            teams_url: << parameters.teams_url >>
            message: << parameters.failed_message >>
            color: "attention"
      condition:
        equels: [success, "$MSG_STATUS"]  
      steps: 
        - send_msg:
            teams_url: << parameters.teams_url >>
            message: << parameters.passed_message >>
            color: "good"
#test
